<!DOCTYPE html>
<html>
<head>
    <title>Role Switcher</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .current-role { background: #28a745; margin-bottom: 20px; padding: 10px; border-radius: 5px; color: white; }
    </style>
</head>
<body>
    <h1>QA Platform - Role Switcher</h1>
    
    <div id="currentRole" class="current-role"></div>
    
    <h3>Switch to Role:</h3>
    <button onclick="switchRole('admin@test.com', 'admin')">Admin</button>
    <button onclick="switchRole('qa_manager@test.com', 'qa_manager')">QA Manager</button>
    <button onclick="switchRole('qa_engineer@test.com', 'qa_engineer')">QA Engineer</button>
    <button onclick="switchRole('developer@test.com', 'developer')">Developer</button>    
    <h3>Actions:</h3>
    <button onclick="openApp()">Open QA Platform</button>
    <button onclick="clearStorage()">Clear Storage</button>

    <script>
        function updateCurrentRole() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const currentRoleDiv = document.getElementById('currentRole');
            if (user.email) {
                currentRoleDiv.innerHTML = `Current Role: ${user.role?.toUpperCase()} (${user.email})`;
            } else {
                currentRoleDiv.innerHTML = 'No user logged in';
            }
        }

        function switchRole(email, role) {
            fetch('http://localhost:3001/api/v1/auth/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email: email, password: 'password'})
            })
            .then(r => r.json())
            .then(data => {
                if (data.token) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    updateCurrentRole();
                    alert(`Switched to ${role} role successfully!`);
                } else {
                    alert('Login failed: ' + JSON.stringify(data));
                }
            })
            .catch(err => {
                alert('Error: ' + err.message);
            });
        }

        function openApp() {
            window.open('http://localhost:5173', '_blank');
        }

        function clearStorage() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            updateCurrentRole();
            alert('Storage cleared!');
        }

        // Update current role on page load
        updateCurrentRole();
    </script>
</body>
</html>